{% extends "base.html" %}

{% block title %}Conferência de Motoristas - Go Mobi{% endblock %}

{% block extra_css %}
<style>
/* ========== CSS MOBILE PARA CONFERÊNCIA DE MOTORISTAS ========== */
@media (max-width: 767px) {
    .desktop-only { display: none !important; }
    .mobile-only { display: block !important; }
    .container-fluid { padding-left: 8px !important; padding-right: 8px !important; }
    
    .mobile-header-relatorio {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white; padding: 16px; margin: -16px -8px 16px -8px;
        border-radius: 0 0 16px 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .mobile-header-relatorio h4 { font-size: 1.1rem; font-weight: 700; margin: 0; }
    
    .filtros-mobile {
        background: white; padding: 16px; border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 16px;
    }
    .filtros-mobile .form-group { margin-bottom: 12px; }
    .filtros-mobile label {
        font-size: 0.875rem; font-weight: 600; color: #374151;
        margin-bottom: 4px; display: block;
    }
    .filtros-mobile input, .filtros-mobile select {
        width: 100%; padding: 10px; border: 1px solid #d1d5db;
        border-radius: 8px; font-size: 0.9rem;
    }
    .filtros-mobile .btn-group-mobile { display: flex; gap: 8px; margin-top: 12px; }
    .filtros-mobile .btn-mobile {
        flex: 1; padding: 12px; border: none; border-radius: 8px;
        font-weight: 600; font-size: 0.9rem; cursor: pointer;
    }
    .btn-mobile-primary { background: #3b82f6; color: white; }
    .btn-mobile-secondary { background: #6b7280; color: white; }
    
    .totalizador-mobile {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white; padding: 16px; border-radius: 12px; margin-bottom: 16px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .totalizador-mobile .total-item {
        display: flex; justify-content: space-between; align-items: center; padding: 8px 0;
    }
    .totalizador-mobile .total-item:not(:last-child) {
        border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .totalizador-mobile .total-label { font-size: 0.875rem; opacity: 0.9; }
    .totalizador-mobile .total-value { font-size: 1.25rem; font-weight: 700; }
    
    .viagem-card-relatorio {
        background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #3b82f6;
    }
    .viagem-card-header-relatorio {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e5e7eb;
    }
    .viagem-id-relatorio { font-size: 0.875rem; font-weight: 700; color: #6b7280; }
    .viagem-status-badge {
        padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600;
    }
    .status-finalizada { background: #d1fae5; color: #065f46; }
    .status-agendada { background: #dbeafe; color: #1e40af; }
    .status-andamento { background: #fef3c7; color: #92400e; }
    .status-em-andamento { background: #fef3c7; color: #92400e; }
    .status-cancelada { background: #fee2e2; color: #991b1b; }
    .status-pendente { background: #e5e7eb; color: #374151; }
    
    .viagem-valor-destaque {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white; padding: 12px; border-radius: 8px; text-align: center; margin-bottom: 12px;
    }
    .viagem-valor-destaque .valor-label { font-size: 0.75rem; opacity: 0.9; margin-bottom: 4px; }
    .viagem-valor-destaque .valor-amount { font-size: 1.5rem; font-weight: 700; }
    
    .viagem-info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 12px; }
    .viagem-info-item { display: flex; flex-direction: column; }
    .viagem-info-label { font-size: 0.75rem; color: #6b7280; margin-bottom: 2px; }
    .viagem-info-value { font-size: 0.875rem; font-weight: 600; color: #111827; }
    
    .viagem-tipo-badge {
        display: inline-block; padding: 4px 8px; border-radius: 6px;
        font-size: 0.75rem; font-weight: 600;
    }
    .tipo-entrada { background: #dbeafe; color: #1e40af; }
    .tipo-saida { background: #fef3c7; color: #92400e; }
    .tipo-saída { background: #fef3c7; color: #92400e; }
    .tipo-desligamento { background: #fee2e2; color: #991b1b; }
    
    .loading-mobile { text-align: center; padding: 40px 20px; }
    .loading-mobile .spinner {
        width: 40px; height: 40px; border: 4px solid #e5e7eb;
        border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .empty-state-mobile { text-align: center; padding: 40px 20px; color: #6b7280; }
    .empty-state-mobile i { font-size: 3rem; margin-bottom: 16px; opacity: 0.5; }
}

@media (min-width: 768px) {
    .mobile-only { display: none !important; }
    .desktop-only { display: block !important; }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    
    <!-- ========== VERSÃO MOBILE (< 768px) ========== -->
    <div class="mobile-only" style="display: none;">
        <div class="mobile-header-relatorio">
            <h4><i class="fas fa-user-tie"></i> Conferência de Motoristas</h4>
        </div>
        
        <div class="filtros-mobile">
            <form id="formFiltrosMobile">
                <div class="form-group">
                    <label>Data Início *</label>
                    <input type="date" name="data_inicio" id="data_inicio_mobile" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Data Fim *</label>
                    <input type="date" name="data_fim" id="data_fim_mobile" class="form-control" required>
                </div>
                {% if user_role != 'motorista' %}
                <div class="form-group">
                    <label>Motorista *</label>
                    <select name="motorista_id" id="motorista_id_mobile" class="form-control" required>
                        <option value="">Selecione...</option>
                        {% for motorista in motoristas %}
                        <option value="{{ motorista.id }}">{{ motorista.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% else %}
                <input type="hidden" name="motorista_id" value="{{ motorista_id_usuario }}">
                {% endif %}
                <div class="form-group">
                    <label>Status</label>
                    <select name="status" id="status_mobile" class="form-control">
                        <option value="">Todos</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Agendada">Agendada</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Finalizada">Finalizada</option>
                        <option value="Cancelada">Cancelada</option>
                    </select>
                </div>
                <div class="btn-group-mobile">
                    <button type="submit" class="btn-mobile btn-mobile-primary">
                        <i class="fas fa-search"></i> Filtrar
                    </button>
                    <button type="button" class="btn-mobile btn-mobile-secondary" onclick="limparFiltrosMobile()">
                        <i class="fas fa-eraser"></i> Limpar
                    </button>
                </div>
            </form>
        </div>
        
        <div id="loadingMobile" class="loading-mobile" style="display: none;">
            <div class="spinner"></div>
            <p style="margin-top: 16px; color: #6b7280;">Carregando...</p>
        </div>
        
        <div id="totalizadorMobile" class="totalizador-mobile" style="display: none;">
            <div class="total-item">
                <span class="total-label">Total de Viagens</span>
                <span class="total-value" id="totalViagensMobile">0</span>
            </div>
            <div class="total-item">
                <span class="total-label">Total Repasse</span>
                <span class="total-value" id="totalRepasseMobile">R$ 0,00</span>
            </div>
        </div>
        
        <div id="viagensMobile"></div>
        
        <div id="emptyStateMobile" class="empty-state-mobile" style="display: none;">
            <i class="fas fa-inbox"></i>
            <p>Nenhuma viagem encontrada</p>
        </div>
    </div>
    
    <!-- ========== VERSÃO DESKTOP (>= 768px) ========== -->
    <div class="card desktop-only">
        <div class="card-header bg-warning text-white">
            <h4 class="mb-0"><i class="fas fa-user-tie"></i> Conferência de Motoristas</h4>
        </div>
        <div class="card-body">
            <!-- Formulário de Filtros -->
            <form id="formFiltros">
                <div class="row">
                    <div class="col-md-3">
                        <label>Data Início *</label>
                        <input type="date" name="data_inicio" id="data_inicio" class="form-control" required>
                    </div>
                    <div class="col-md-3">
                        <label>Data Fim *</label>
                        <input type="date" name="data_fim" id="data_fim" class="form-control" required>
                    </div>
                    <div class="col-md-3">
                        <label>Motorista {% if user_role != 'motorista' %}*{% endif %}</label>
                        <!-- CORRIGIDO: Filtro fixo para motoristas logados -->
                        <select name="motorista_id" id="motorista_id" class="form-control"
                                {% if user_role == 'motorista' %}disabled{% endif %}
                                {% if user_role != 'motorista' %}required{% endif %}>
                            {% if motorista_id_usuario %}
                                <!-- Motorista vê apenas ele mesmo -->
                                {% for motorista in motoristas %}
                                <option value="{{ motorista.id }}" selected>{{ motorista.nome }}</option>
                                {% endfor %}
                            {% else %}
                                <!-- Admin pode selecionar qualquer motorista -->
                                <option value="">Selecione...</option>
                                {% for motorista in motoristas %}
                                <option value="{{ motorista.id }}">{{ motorista.nome }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                        <!-- Campo hidden para enviar o valor quando disabled -->
                        {% if user_role == 'motorista' and motorista_id_usuario %}
                        <input type="hidden" name="motorista_id" value="{{ motorista_id_usuario }}">
                        {% endif %}
                    </div>
                    <div class="col-md-3">
                        <label>Status</label>
                        <select name="status" id="status" class="form-control">
                            <option value="">Todos</option>
                            <option value="Pendente">Pendente</option>
                            <option value="Agendada">Agendada</option>
                            <option value="Em Andamento">Em Andamento</option>
                            <option value="Finalizada">Finalizada</option>
                            <option value="Cancelada">Cancelada</option>
                        </select>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Gerar Relatório
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="limparFiltros()">
                            <i class="fas fa-eraser"></i> Limpar Filtros
                        </button>
                    </div>
                </div>
            </form>

            <!-- Loading -->
            <div id="loading" class="text-center mt-4" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Carregando...</span>
                </div>
                <p>Gerando relatório...</p>
            </div>

            <!-- Área de Resultados -->
            <div id="areaResultados" class="mt-4" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>Resultados: <span id="totalRegistros">0</span> viagens</h5>
                    <div>
                        <button type="button" class="btn btn-success" onclick="exportarExcel()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                        <button type="button" class="btn btn-danger" onclick="exportarPDF()">
                            <i class="fas fa-file-pdf"></i> Exportar PDF
                        </button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th>ID</th>
                                <th>Data</th>
                                <th>Horário</th>
                                <th>Motorista</th>
                                <th>Empresa</th>
                                <th>Planta</th>
                                <th>Tipo Corrida</th>
                                <th>Passageiros</th>
                                <th>Colaboradores</th>
                                <th>Bairros</th>
                                <th>Valor Repasse</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="corpoTabela">
                            <!-- Dados serão inseridos aqui via JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr class="font-weight-bold">
                                <td colspan="11" class="text-right">TOTAL REPASSE:</td>
                                <td id="totalRepasse">R$ 0,00</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <!-- Controles de Paginação -->
                <div class="d-flex justify-content-between align-items-center mt-3" id="controlesPaginacao" style="display:none !important;">
                    <button id="btnAnterior" class="btn btn-secondary" onclick="navegarPagina(-1)" disabled>
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                    
                    <span id="infoPagina" class="text-muted">
                        Página 1 de 1 (0 registros)
                    </span>
                    
                    <button id="btnProxima" class="btn btn-secondary" onclick="navegarPagina(1)" disabled>
                        Próxima <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
/* Garantir que os badges tenham cores visíveis */
.badge-warning { background-color: #ffc107 !important; color: #212529 !important; }
.badge-primary { background-color: #007bff !important; color: #ffffff !important; }
.badge-success { background-color: #28a745 !important; color: #ffffff !important; }
.badge-danger { background-color: #dc3545 !important; color: #ffffff !important; }
.badge-info { background-color: #17a2b8 !important; color: #ffffff !important; }
.badge-secondary { background-color: #6c757d !important; color: #ffffff !important; }
</style>

<script>
let dadosRelatorio = [];
let paginaAtual = 1;
let totalPaginas = 1;
let totalRegistrosGlobal = 0;

// Definir datas padrão
$(document).ready(function() {
    const hoje = new Date();
    const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
    
    $('#data_inicio').val(primeiroDia.toISOString().split('T')[0]);
    $('#data_fim').val(hoje.toISOString().split('T')[0]);
});

// Submeter formulário
$('#formFiltros').on('submit', function(e) {
    e.preventDefault();
    
    $('#loading').show();
    $('#areaResultados').hide();
    
    $.ajax({
        url: '{{ url_for("relatorios.dados_conferencia_motoristas") }}',
        type: 'POST',
        data: $(this).serialize() + '&pagina=' + paginaAtual,
        success: function(response) {
            $('#loading').hide();
            
            if (response.success) {
                dadosRelatorio = response.dados;
                paginaAtual = response.pagina_atual || 1;
                totalPaginas = response.total_paginas || 1;
                totalRegistrosGlobal = response.total_registros || response.total;
                
                exibirResultados(response.dados, response.total, response.valor_total_repasse);
                atualizarControlesPaginacao();
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Erro',
                    text: response.message || 'Erro ao gerar relatório'
                });
            }
        },
        error: function(xhr) {
            $('#loading').hide();
            let errorMsg = 'Erro ao gerar relatório. Tente novamente.';
            if (xhr.responseJSON && xhr.responseJSON.message) {
                errorMsg = xhr.responseJSON.message;
            }

            console.error('Erro:', xhr);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: errorMsg
            });
        }
    });
});

// Função para obter badge colorido baseado no status
function getStatusBadge(status) {
    if (!status || status === "N/A") return '<span class="badge badge-secondary">N/A</span>';
    let badgeClass = "badge-secondary";
    if (status === "Pendente") badgeClass = "badge-warning";
    else if (status === "Agendada") badgeClass = "badge-info";
    else if (status === "Em Andamento") badgeClass = "badge-primary";
    else if (status === "Finalizada") badgeClass = "badge-success";
    else if (status === "Cancelada") badgeClass = "badge-danger";
    return `<span class="badge ${badgeClass}">${status}</span>`;
}

// Exibir resultados na tabela
function exibirResultados(dados, total, valorTotalRepasse) {
    const tbody = $('#corpoTabela');
    tbody.empty();
    
    if (dados.length === 0) {
        tbody.append('<tr><td colspan="12" class="text-center">Nenhuma viagem encontrada</td></tr>');
        $('#areaResultados').show();
        return;
    }
    
    dados.forEach(function(item) {
        const tr = $('<tr>');
        tr.append(`<td>${item.id}</td>`);
        tr.append(`<td>${item.data_viagem}</td>`);
        tr.append(`<td>${item.horario}</td>`);
        tr.append(`<td>${item.motorista}</td>`);
        tr.append(`<td>${item.empresa}</td>`);
        tr.append(`<td>${item.planta}</td>`);
        tr.append(`<td>${item.tipo_corrida}</td>`);
        tr.append(`<td>${item.qtd_passageiros}</td>`);
        tr.append(`<td>${item.colaboradores}</td>`);
        tr.append(`<td>${item.bairros || 'N/A'}</td>`);
        tr.append(`<td>R$ ${item.valor_repasse.toFixed(2)}</td>`);
        tr.append(`<td>${getStatusBadge(item.status)}</td>`);
        tbody.append(tr);
    });
    
    $('#totalRegistros').text(total);
    $('#totalRepasse').text('R$ ' + valorTotalRepasse.toFixed(2));
    $('#areaResultados').show();
}

// Navegar entre páginas
function navegarPagina(direcao) {
    paginaAtual += direcao;
    $('#formFiltros').submit();
}

// Atualizar controles
function atualizarControlesPaginacao() {
    if (totalPaginas > 1) {
        $('#controlesPaginacao').show();
        $('#btnAnterior').prop('disabled', paginaAtual === 1);
        $('#btnProxima').prop('disabled', paginaAtual === totalPaginas);
        $('#infoPagina').text(`Página ${paginaAtual} de ${totalPaginas} (${totalRegistrosGlobal} registros)`);
    } else {
        $('#controlesPaginacao').hide();
    }
}

// Limpar filtros
function limparFiltros() {
    paginaAtual = 1;
    $('#formFiltros')[0].reset();
    $('#areaResultados').hide();
    
    // Redefinir datas padrão
    const hoje = new Date();
    const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
    $('#data_inicio').val(primeiroDia.toISOString().split('T')[0]);
    $('#data_fim').val(hoje.toISOString().split('T')[0]);
}

// Exportar para Excel
function exportarExcel() {
    if (totalRegistrosGlobal === 0 && dadosRelatorio.length === 0) {
        Swal.fire({
            icon: 'warning',
            title: 'Atenção',
            text: 'Não há dados para exportar'
        });
        return;
    }
    
    Swal.fire({title: 'Exportando...', text: 'Buscando todos os registros...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); }});
    var paginaAtualBackup = paginaAtual;
    paginaAtual = 0;
    $.ajax({
        url: '{{ url_for("relatorios.dados_conferencia_motoristas") }}',
        type: 'POST',
        data: $('#formFiltros').serialize() + '&pagina=0',
        success: function(response) {
            paginaAtual = paginaAtualBackup;
            Swal.close();
            if (response.success) {
                const form = $('<form>', {method: 'POST', action: '{{ url_for("relatorios.exportar_excel", tipo="motoristas") }}'});
                form.append($('<input>', {type: 'hidden', name: 'dados', value: JSON.stringify(response.dados)}));
                $('body').append(form);
                form.submit();
                form.remove();
            }
        },
        error: function() { paginaAtual = paginaAtualBackup; Swal.fire('Erro', 'Erro ao buscar dados', 'error'); }
    });
}

// Exportar para PDF
function exportarPDF() {
    if (totalRegistrosGlobal === 0 && dadosRelatorio.length === 0) {
        Swal.fire({
            icon: 'warning',
            title: 'Atenção',
            text: 'Não há dados para exportar'
        });
        return;
    }
    
    Swal.fire({title: 'Exportando...', text: 'Buscando todos os registros...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); }});
    var paginaAtualBackup = paginaAtual;
    paginaAtual = 0;
    $.ajax({
        url: '{{ url_for("relatorios.dados_conferencia_motoristas") }}',
        type: 'POST',
        data: $('#formFiltros').serialize() + '&pagina=0',
        success: function(response) {
            paginaAtual = paginaAtualBackup;
            Swal.close();
            if (response.success) {
                const form = $('<form>', {method: 'POST', action: '{{ url_for("relatorios.exportar_pdf", tipo="motoristas") }}'});
                form.append($('<input>', {type: 'hidden', name: 'dados', value: JSON.stringify(response.dados)}));
                $('body').append(form);
                form.submit();
                form.remove();
            }
        },
        error: function() { paginaAtual = paginaAtualBackup; Swal.fire('Erro', 'Erro ao buscar dados', 'error'); }
    });
}

// ========== JAVASCRIPT MOBILE ==========
$(document).ready(function() {
    const hoje = new Date();
    const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
    $('#data_inicio_mobile').val(primeiroDia.toISOString().split('T')[0]);
    $('#data_fim_mobile').val(hoje.toISOString().split('T')[0]);
});

$('#formFiltrosMobile').on('submit', function(e) {
    e.preventDefault();
    $('#loadingMobile').show();
    $('#totalizadorMobile').hide();
    $('#viagensMobile').empty();
    $('#emptyStateMobile').hide();
    
    $.ajax({
        url: '{{ url_for("relatorios.dados_conferencia_motoristas") }}',
        type: 'POST',
        data: $(this).serialize() + '&pagina=0',
        success: function(response) {
            $('#loadingMobile').hide();
            if (response.success && response.dados.length > 0) {
                $('#totalizadorMobile').show();
                $('#totalViagensMobile').text(response.total);
                $('#totalRepasseMobile').text('R$ ' + response.valor_total_repasse.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}));
                renderizarViagensMobile(response.dados);
            } else {
                $('#emptyStateMobile').show();
            }
        },
        error: function(xhr) {
            $('#loadingMobile').hide();
            alert('Erro ao carregar dados');
        }
    });
});

function renderizarViagensMobile(viagens) {
    const container = $('#viagensMobile');
    container.empty();
    viagens.forEach(viagem => {
        const statusClass = viagem.status.toLowerCase().replace(/ /g, '-');
        const tipoClass = viagem.tipo_corrida.toLowerCase();
        const card = `
            <div class="viagem-card-relatorio">
                <div class="viagem-card-header-relatorio">
                    <div class="viagem-id-relatorio">#${viagem.id}</div>
                    <div class="viagem-status-badge status-${statusClass}">${viagem.status}</div>
                </div>
                <div class="viagem-valor-destaque">
                    <div class="valor-label">Valor Repasse</div>
                    <div class="valor-amount">R$ ${parseFloat(viagem.valor_repasse || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                </div>
                <div class="viagem-info-grid">
                    <div class="viagem-info-item">
                        <div class="viagem-info-label">Data</div>
                        <div class="viagem-info-value">${viagem.data_viagem}</div>
                    </div>
                    <div class="viagem-info-item">
                        <div class="viagem-info-label">Horário</div>
                        <div class="viagem-info-value">${viagem.horario}</div>
                    </div>
                    <div class="viagem-info-item">
                        <div class="viagem-info-label">Tipo</div>
                        <div class="viagem-info-value">
                            <span class="viagem-tipo-badge tipo-${tipoClass}">${viagem.tipo_corrida}</span>
                        </div>
                    </div>
                    <div class="viagem-info-item">
                        <div class="viagem-info-label">Passageiros</div>
                        <div class="viagem-info-value">${viagem.passageiros}</div>
                    </div>
                    <div class="viagem-info-item" style="grid-column: 1 / -1;">
                        <div class="viagem-info-label">Empresa - Planta</div>
                        <div class="viagem-info-value">${viagem.empresa} - ${viagem.planta}</div>
                    </div>
                    <div class="viagem-info-item" style="grid-column: 1 / -1;">
                        <div class="viagem-info-label">Colaboradores</div>
                        <div class="viagem-info-value" style="font-size: 0.8rem;">${viagem.colaboradores || 'N/A'}</div>
                    </div>
                    ${viagem.bairros ? `
                    <div class="viagem-info-item" style="grid-column: 1 / -1;">
                        <div class="viagem-info-label">Bairros</div>
                        <div class="viagem-info-value" style="font-size: 0.8rem;">${viagem.bairros}</div>
                    </div>
                    ` : ''}
                </div>
            </div>
        `;
        container.append(card);
    });
}

function limparFiltrosMobile() {
    const hoje = new Date();
    const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
    $('#data_inicio_mobile').val(primeiroDia.toISOString().split('T')[0]);
    $('#data_fim_mobile').val(hoje.toISOString().split('T')[0]);
    $('#status_mobile').val('');
    if ($('#motorista_id_mobile').length) { $('#motorista_id_mobile').val(''); }
    $('#totalizadorMobile').hide();
    $('#viagensMobile').empty();
    $('#emptyStateMobile').hide();
}
</script>
{% endblock %}  